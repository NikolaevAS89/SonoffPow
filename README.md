# Sonoff pow
простая прошивка для управления питанием и получения сведений о потребляемом электричестве

## EEPROM
В энергонезависимую память сохраняется параметры для создания и подключения к Wifi.
При этом если происходит сбой в хранении, то параметры режима AP устанавливаются как ssid="esp8266_ssid", а password="esp8266_pass". Проверка сбоя происходит по байтовой контрольной сумме всей информации в памяти.

## CLI
разбор команды определяется первой буквой в сообщении
команда | пример | описание
-----+--------+------------
r | 'r' | переключение реле
d | 'd' | вывод значений мощьности, тока, вольтажа и частоты тока
w | 'w' | переключение режима работы WiFi
p | 'p{"ssid": ssid, "password": password}' | конфигурирование Access point 
s | 'p{"ssid": ssid, "password": password}' | конфигурирование соединение с Access point
k | 'k' | перезагрузка

иначе происходит возврат введенной команды

## REST API
path | тип | тело
-----+--------+------------
/ | GET | нет
/relay | GET | нет
/measure | GET | нет
/restart | GET | нет
/config/wifi | POST | {"ssid": ssid, "password": password}
/config/ap | POST | {"ssid": ssid, "password": password}

## Кнопка
одиночное кратковременное нажатие переключает режим реле, при этом быстрые кратковременные нажатия могут воспринематься как одно долгое.
Долгое нажатие производи попытку переключения режима работы с WiFi.

## WiFi

### Режим Access point
При переходе в этот режим происходит попытка создания точки доступа с предустановленными параметрами.
При этом модуль имеет ip 192.168.4.1 и слушает порт 80.

### Режим Station
В этом режиме модуль выполняет несколько попыток соединения с точкой доступа по предустановленным параметрам.
При неудаче модуль переходит в режим Access point.